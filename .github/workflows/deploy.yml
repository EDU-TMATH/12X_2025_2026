name: Deploy Student Sites

on:
  push:
    paths:
      - "sites/**"

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Install Wrangler
        run: npm install -g wrangler@latest

      - name: Deploy to Cloudflare Pages
        env:
          CF_API_TOKEN: ${{ secrets.CF_API_TOKEN }}
          CF_ACCOUNT_ID: ${{ secrets.CF_ACCOUNT_ID }}
        run: |
          # Láº¥y thÆ° má»¥c thay Ä‘á»•i
          CHANGED=$(git diff --name-only HEAD~1 HEAD | cut -d/ -f1-2 | uniq)

          for dir in $CHANGED; do
            # dir dáº¡ng: sites/huy â†’ láº¥y tÃªn huy
            USER=$(echo "$dir" | cut -d/ -f2)

            echo "ðŸš€ Deploying project for: $USER"
            npx wrangler pages publish "sites/$USER" \
              --project-name="$USER" \
              --branch=main
          done
